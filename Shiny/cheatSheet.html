<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>One Page Shiny References</title>
  <style>
    :root{
      --bg:#ffffff;
      --panel:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --accent:#2563eb;
      --good:#16a34a;
      --warn:#d97706;
      --bad:#dc2626;
      --border:#e5e7eb;
      --code:#0b1020;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:var(--sans);
      background: var(--bg);
      color:var(--text);
      line-height:1.55;
    }

    header{
      padding:34px 18px 14px;
      max-width:1100px;
      margin:0 auto;
    }

    h1{
      margin:0 0 8px;
      font-size: clamp(24px, 3vw, 36px);
      letter-spacing:0.2px;
    }

    .subtitle{
      color:var(--muted);
      max-width: 90ch;
      font-size: 15px;
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:0 18px 60px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
      align-items:start;
    }

    @media(min-width: 980px){
      .grid{
        grid-template-columns: 320px 1fr;
        gap:18px;
      }
      .sticky{
        position:sticky;
        top:16px;
        align-self:start;
      }
    }

    .card{
      background: var(--panel);
      border:1px solid var(--border);
      border-radius:16px;
      padding:16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    .toc a{
      display:block;
      color:var(--muted);
      text-decoration:none;
      padding:7px 10px;
      border-radius:10px;
      border:1px solid transparent;
      margin:2px 0;
      font-size: 14px;
    }

    .toc a:hover{
      color:var(--text);
      border-color: rgba(37,99,235,0.25);
      background: rgba(37,99,235,0.06);
    }

    .tag{
      display:inline-block;
      font-size:12px;
      padding:3px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      color:var(--muted);
      background: rgba(17,24,39,0.03);
      margin-right:6px;
      margin-bottom:6px;
    }

    h2{
      margin: 0 0 10px;
      font-size: 22px;
    }

    h3{
      margin: 16px 0 8px;
      font-size: 18px;
    }

    h4{
      margin: 14px 0 6px;
      font-size: 15px;
      color: var(--text);
    }

    p{ margin: 10px 0; color: var(--muted); }
    ul{ margin: 8px 0 12px 22px; color: var(--muted); }
    li{ margin: 6px 0; }

    .hr{
      height:1px;
      background: var(--border);
      margin: 18px 0;
    }

    .callout{
      border-left: 4px solid rgba(37,99,235,0.45);
      padding: 10px 12px;
      background: rgba(37,99,235,0.06);
      border-radius: 12px;
      margin: 12px 0;
      color: var(--muted);
    }

    .callout.good{ border-left-color: rgba(22,163,74,0.55); background: rgba(22,163,74,0.06); }
    .callout.warn{ border-left-color: rgba(217,119,6,0.55); background: rgba(217,119,6,0.06); }
    .callout.bad{ border-left-color: rgba(220,38,38,0.55); background: rgba(220,38,38,0.06); }

    .code{
      background: var(--code);
      border:1px solid rgba(255,255,255,0.10);
      border-radius: 14px;
      padding: 12px;
      overflow:auto;
      font-family: var(--mono);
      font-size: 12.75px;
      line-height: 1.45;
      margin: 10px 0 14px;
      white-space: pre;
      color:#e7eef7;
    }

    .mini{
      font-size: 13px;
      color: var(--muted);
    }

    .pill{
      display:inline-block;
      font-size:12px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(17,24,39,0.03);
      color: var(--muted);
      margin-left: 6px;
      vertical-align: middle;
    }

    .two-col{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }

    @media(min-width: 900px){
      .two-col{
        grid-template-columns: 1fr 1fr;
      }
    }

    .foot{
      color: var(--muted);
      font-size: 13px;
      margin-top: 18px;
    }

    code{
      font-family: var(--mono);
      font-size: 0.95em;
      background: rgba(17,24,39,0.03);
      border: 1px solid var(--border);
      padding: 0 6px;
      border-radius: 8px;
      color: var(--text);
    }
  </style>
</head>
<body>
  <header>
    <h1>One Page Shiny References</h1>
    <div class="subtitle">
      A detailed quick reference for the Shiny functions used in Week 2. You might find it helpful to glance at this page as needed.
    </div>
  </header>

  <div class="wrap">
    <div class="grid">
      <aside class="card sticky toc">
        <div style="margin-bottom:10px;">

        </div>
        <a href="#skeleton">App structure</a>
        <a href="#layout">Layout building blocks</a>
        <a href="#inputs">Input functions</a>
        <a href="#outputs">Output functions</a>
        <a href="#reactivity">Reactivity tools</a>
        <a href="#update">Updating inputs</a>
        <a href="#plots">Plotting</a>
        <a href="#tables">Tables</a>
        <a href="#downloads">Downloads</a>
        <a href="#errors">Validation and friendly errors</a>
        <a href="#perf">Performance habits</a>
        <a href="#polish">Polishing</a>
        <a href="#beyond">Extra ideas</a>
      </aside>

      <main class="card">
        <section id="skeleton">
          <h2>App structure</h2>
          <p>
            A Shiny app is typically built from two parts:
            <b>UI</b> (what the user sees) and <b>server</b> (the R backend logic).
            In Week 2, you keep both in one file called <b>app.R</b>.
          </p>

          <div class="code">library(shiny)

ui <- fluidPage(
  titlePanel("My App"),
  mainPanel(
    plotOutput("p1")
  )
)

server <- function(input, output, session) {
  output$p1 <- renderPlot({
    hist(rnorm(100))
  })
}

shinyApp(ui, server)</div>

          <ul>
            <li><b>ui</b> holds layout, input controls, and placeholders for outputs.</li>
            <li><b>server</b> computes outputs and reacts to input changes.</li>
            <li><code>shinyApp(ui, server)</code> calls both parts together and runs the app.</li>
          </ul>

          <div class="callout good">
            <b>Useful habit:</b><br/>
            Build your app in stages. At each stage, you should be able to run it and see something working.
          </div>
        </section>

        <div class="hr"></div>

        <section id="layout">
          <h2>Layout building blocks</h2>

          <h3><code>fluidPage()</code> <span class="pill">top-level container</span></h3>
          <p>
            A responsive page layout. It scales to different screen sizes.
          </p>

          <h3><code>titlePanel()</code> <span class="pill">page heading</span></h3>
          <p>
            Adds a simple title at the top. Good for quick prototypes.
            For more control, you can use <code>h1()</code>, <code>h2()</code>, etc.
          </p>

          <h3><code>sidebarLayout()</code>, <code>sidebarPanel()</code>, <code>mainPanel()</code></h3>
          <p>
            A common “dashboard-style” layout: controls on the left, results on the right.
          </p>
          <div class="code">ui <- fluidPage(
  titlePanel("Transport Dashboard"),
  sidebarLayout(
    sidebarPanel(
      selectInput("city", "City", choices = c("London","Manchester")),
      dateRangeInput("dates", "Date range")
    ),
    mainPanel(
      plotOutput("p_riders"),
      tableOutput("summary_tbl")
    )
  )
)</div>

          <h3><code>tabsetPanel()</code>, <code>tabPanel()</code> <span class="pill">organise outputs</span></h3>
          <p>
            Use tabs when you have multiple plots/tables and want to reduce scrolling.
          </p>
          <div class="code">mainPanel(
  tabsetPanel(
    tabPanel("Ridership", plotOutput("p_riders")),
    tabPanel("Price vs Demand", plotOutput("p_price")),
    tabPanel("Summary", tableOutput("summary_tbl"))
  )
)</div>

          <h3><code>fluidRow()</code>, <code>column()</code> <span class="pill">grid layout</span></h3>
          <p>
            Arrange elements in rows and columns. Useful for KPI displays.
          </p>
          <div class="code">fluidRow(
  column(4, strong("Total riders:"), textOutput("kpi_total")),
  column(4, strong("Mean delay:"),  textOutput("kpi_delay")),
  column(4, strong("Mean price:"),  textOutput("kpi_price"))
)</div>
          <p class="mini">
            Columns use a 12-unit grid. Three equal columns each use 4.
          </p>
        </section>

        <div class="hr"></div>

        <section id="inputs">
          <h2>Input functions</h2>
          <p>
            Inputs create controls that the user can interact with.
            In server code, you read the current value using <code>input$ID</code>.
          </p>

          <div class="two-col">
            <div>
              <h3><code>selectInput()</code> <span class="pill">choose from a list</span></h3>
              <p>A dropdown selector. Good for city and mode filters.</p>
              <div class="code">selectInput(
  inputId = "city",
  label   = "City",
  choices = c("London", "Manchester"),
  selected = "London",
  multiple = TRUE
)</div>
              <ul>
                <li><b>multiple = TRUE:</b> select more than one.</li>
                <li><b>Reading value:</b> <code>input$city</code> (vector if multiple selected).</li>
              </ul>
            </div>

            <div>
              <h3><code>checkboxInput()</code> <span class="pill">simple toggle</span></h3>
              <p>A single on/off switch.</p>
              <div class="code">checkboxInput(
  inputId = "smooth",
  label   = "Show smooth curve",
  value   = FALSE
)</div>
              <ul>
                <li><b>Reading value:</b> <code>isTRUE(input$smooth)</code>.</li>
              </ul>
            </div>
          </div>

          <h3><code>dateRangeInput()</code> <span class="pill">filter by dates</span></h3>
          <p>
            Select a start date and end date. <code>input$dates</code> returns a vector of length 2.
          </p>
          <div class="code">dateRangeInput(
  inputId = "dates",
  label   = "Date range",
  start   = as.Date("2025-01-01"),
  end     = as.Date("2025-03-31")
)</div>
          <ul>
            <li><b>Reading value:</b> <code>input$dates[1]</code> is start, <code>input$dates[2]</code> is end.</li>
            <li><b>Tip:</b> Convert your data date column with <code>as.Date()</code> before filtering.</li>
          </ul>

          <div class="callout warn">
            <b>Input IDs must be unique.</b><br/>
            If your UI uses <code>selectInput("city", ...)</code>, your server reads <code>input$city</code>.
          </div>
        </section>

        <div class="hr"></div>

        <section id="outputs">
          <h2>Output functions</h2>
          <p>
            Outputs come in pairs: a UI placeholder and a server renderer.
          </p>

          <h3><code>plotOutput()</code> + <code>renderPlot()</code></h3>
          <div class="code"># UI
plotOutput("p_riders")

# Server
output$p_riders <- renderPlot({
  ggplot(df, aes(date, daily_riders)) + geom_line()
})</div>

          <h3><code>tableOutput()</code> + <code>renderTable()</code></h3>
          <div class="code"># UI
tableOutput("summary_tbl")

# Server
output$summary_tbl <- renderTable({
  summary_df
})</div>

          <h3><code>textOutput()</code> + <code>renderText()</code></h3>
          <div class="code"># UI
textOutput("kpi_total")

# Server
output$kpi_total <- renderText({
  format(sum(df$daily_riders), big.mark = ",")
})</div>

          <h3><code>uiOutput()</code> + <code>renderUI()</code> <span class="pill">dynamic UI</span></h3>
          <div class="code"># UI
uiOutput("filter_warning")

# Server
output$filter_warning <- renderUI({
  if(nrow(filtered_data()) == 0){
    div(style="color:#d97706;", "No rows match your filters.")
  } else {
    NULL
  }
})</div>
        </section>

        <div class="hr"></div>

        <section id="reactivity">
          <h2>Reactivity tools</h2>

          <h3><code>reactive()</code> <span class="pill">reactive value producer</span></h3>
          <p>
            A <code>reactive()</code> expression behaves like a function. You call it as <code>filtered_data()</code>.
          </p>
          <div class="code">filtered_data <- reactive({
  req(input$city, input$mode, input$dates)

  df %>%
    filter(city %in% input$city) %>%
    filter(mode %in% input$mode) %>%
    filter(date >= input$dates[1], date <= input$dates[2])
})</div>

          <h3><code>req()</code> <span class="pill">guard against missing inputs</span></h3>
          <div class="code">filtered_data <- reactive({
  req(input$city)
  req(input$dates)
  ...
})</div>

          <h3><code>isTRUE()</code> <span class="pill">safe TRUE check</span></h3>
          <div class="code">if (isTRUE(input$smooth)) {
  p <- p + geom_smooth(se = FALSE)
}</div>

          <div class="callout warn">
            <b>Golden rule for Week 2:</b><br/>
            One reactive filtered dataset. Everything else uses it.
          </div>
        </section>

        <div class="hr"></div>

        <section id="update">
          <h2>Updating inputs from data</h2>
          <p>Load data once, then populate choices and sensible defaults.</p>

          <h3><code>observe()</code> <span class="pill">run code reactively</span></h3>
          <h3><code>updateSelectInput()</code> and <code>updateDateRangeInput()</code></h3>
          <div class="code">observe({
  updateSelectInput(session, "city",
    choices  = sort(unique(df$city)),
    selected = unique(df$city)[1]
  )

  updateSelectInput(session, "mode",
    choices  = sort(unique(df$mode)),
    selected = unique(df$mode)[1]
  )

  updateDateRangeInput(session, "dates",
    start = min(df$date, na.rm = TRUE),
    end   = max(df$date, na.rm = TRUE)
  )
})</div>
        </section>

        <div class="hr"></div>

        <section id="plots">
          <h2>Plotting</h2>

          <h3>Ridership over time (conditional faceting)</h3>
          <div class="code">output$p_riders <- renderPlot({
  fd <- filtered_data()

  p <- ggplot(fd, aes(x = date, y = daily_riders, color = mode)) +
    geom_line() +
    labs(x = "Date", y = "Daily riders")

  if (length(input$city) > 1) {
    p <- p + facet_wrap(~ city, scales = "free_y")
  }

  p
})</div>

          <h3>Ticket price vs daily riders with optional smoothing</h3>
          <div class="code">output$p_price <- renderPlot({
  fd <- filtered_data()

  p <- ggplot(fd, aes(x = ticket_price, y = daily_riders)) +
    geom_point(alpha = 0.6) +
    labs(x = "Ticket price", y = "Daily riders")

  if (isTRUE(input$smooth)) {
    p <- p + geom_smooth(se = FALSE)
  }

  p
})</div>
        </section>

        <div class="hr"></div>

        <section id="tables">
          <h2>Tables</h2>

          <h3>Summary table</h3>
          <div class="code">output$summary_tbl <- renderTable({
  fd <- filtered_data()

  fd %>%
    group_by(city, mode) %>%
    summarise(
      total_riders      = sum(daily_riders, na.rm = TRUE),
      mean_delay_mins   = mean(avg_delay_mins, na.rm = TRUE),
      mean_ticket_price = mean(ticket_price, na.rm = TRUE),
      .groups = "drop"
    ) %>%
    arrange(desc(total_riders))
})</div>

          <h3>KPI values</h3>
          <div class="code">output$kpi_total <- renderText({
  fd <- filtered_data()
  format(sum(fd$daily_riders, na.rm = TRUE), big.mark = ",")
})

output$kpi_delay <- renderText({
  fd <- filtered_data()
  round(mean(fd$avg_delay_mins, na.rm = TRUE), 2)
})

output$kpi_price <- renderText({
  fd <- filtered_data()
  round(mean(fd$ticket_price, na.rm = TRUE), 2)
})</div>
        </section>

        <div class="hr"></div>

        <section id="downloads">
          <h2>Downloads</h2>

          <h3><code>downloadButton()</code> + <code>downloadHandler()</code></h3>

          <h4>Download filtered CSV</h4>
          <div class="code"># UI
downloadButton("download_csv", "Download filtered CSV")

# Server
output$download_csv <- downloadHandler(
  filename = function() {
    paste0("filtered_transport_", Sys.Date(), ".csv")
  },
  content = function(file) {
    write.csv(filtered_data(), file, row.names = FALSE)
  }
)</div>

          <h4>Download plot as PNG</h4>
          <div class="code"># UI
downloadButton("download_plot", "Download riders plot (PNG)")

# Server
output$download_plot <- downloadHandler(
  filename = function() {
    paste0("ridership_plot_", Sys.Date(), ".png")
  },
  content = function(file) {
    png(file, width = 1200, height = 700)

    fd <- filtered_data()

    p <- ggplot(fd, aes(x = date, y = daily_riders, color = mode)) +
      geom_line() +
      labs(x = "Date", y = "Daily riders")

    if (length(input$city) > 1) {
      p <- p + facet_wrap(~ city, scales = "free_y")
    }

    print(p)
    dev.off()
  }
)</div>
        </section>

        <div class="hr"></div>

        <section id="errors">
          <h2>Validation and friendly errors</h2>

          <h3><code>validate()</code> + <code>need()</code> <span class="pill">show message instead of crashing</span></h3>
          <div class="code">output$p_riders <- renderPlot({
  fd <- filtered_data()

  validate(
    need(nrow(fd) > 0, "No data matches your filters. Try expanding the date range or selecting more modes.")
  )

  ggplot(fd, aes(date, daily_riders, color = mode)) + geom_line()
})</div>

          <div class="callout warn">
            <b>Most common crash cause in Week 2:</b><br/>
            Your filters return 0 rows and the plot tries to draw anyway. Add <code>validate(need(...))</code>.
          </div>
        </section>

        <div class="hr"></div>

        <section id="perf">
          <h2>Performance habits</h2>
          <ul>
            <li><b>Read data once:</b> do not re-read CSV inside each output.</li>
            <li><b>Filter once:</b> one <code>filtered_data()</code> used everywhere.</li>
            <li><b>Summarise once:</b> if multiple outputs need the same summary, make a reactive summary.</li>
          </ul>

          <div class="callout good">
            <b>Small but useful upgrade:</b><br/>
            Create <code>summary_data <- reactive({ ... })</code>, then use it for both the table and KPIs.
          </div>
        </section>

        <div class="hr"></div>

        <section id="polish">
          <h2>Polishing</h2>

          <h3><code>bslib</code> <span class="pill">recommended</span></h3>
          <p>
            <b>bslib</b> themes Bootstrap based Shiny apps. It improves presentation without changing server logic.
          </p>
          <div class="code">install.packages("bslib")
library(bslib)

ui <- fluidPage(
  theme = bs_theme(bootswatch = "flatly"),
  ...
)</div>

          <h3><code>shinydashboard</code> <span class="pill">dashboard layout</span></h3>
          <p>
            A classic admin dashboard look: sidebar, header, boxed content. Useful when your app becomes larger.
          </p>

          <h3><code>shinythemes</code> <span class="pill">quick themes</span></h3>
          <p>
            A fast way to apply a theme. Less flexible than bslib, but simple to try.
          </p>
        </section>

        <div class="hr"></div>

        <section id="beyond">
          <h2>Extra ideas</h2>
          <p>Knowing the names helps you search and learn faster later.</p>
          <ul>
            <li><b><code>observeEvent()</code></b>: run code when a specific input changes, often a button click.</li>
            <li><b><code>reactiveValues()</code></b>: store state that can change over time.</li>
            <li><b>Modules</b>: reusable UI + server chunks for large apps.</li>
            <li><b>Deployment</b>: shinyapps.io or Shiny Server. Free tiers have runtime limits.</li>
            <li><b>Interactivity</b>: plotly for hover and zoom.</li>
          </ul>

          <div class="foot">
            EL 2026
          </div>
        </section>
      </main>
    </div>
  </div>
</body>
</html>